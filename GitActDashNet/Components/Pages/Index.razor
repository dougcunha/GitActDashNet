@page "/"
@inject Services.AuthService AuthService
@inject NavigationManager Navigation

@if (isLoading)
{
    <div class="d-flex justify-center align-center" style="height: 100vh;">
        <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
    </div>
}

@code {
    private bool isLoading = true;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await CheckAuthenticationAndRedirect();
        }
    }

    private async Task CheckAuthenticationAndRedirect()
    {
        try
        {
            var isAuthenticated = await AuthService.IsAuthenticatedAsync();

            Navigation.NavigateTo(isAuthenticated ? "/dashboard" : "/login", replace: true);
        }
        catch
        {
            // Em caso de erro, redireciona para login
            Navigation.NavigateTo("/login", replace: true);
        }
    }
}
